{% extends "base.html" %}

{% block content %}
<div class="container">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="hero-section text-center text-white py-4">
                <h1 class="display-5 fw-bold mb-3">
                    <i class="bi bi-currency-dollar me-3"></i>
                    Loan Rate Comparison
                </h1>
                <p class="lead">Compare interest rates from 5+ Azerbaijan banks instantly</p>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Loan Comparison Form -->
        <div class="col-lg-4 mb-4">
            <div class="feature-card">
                <div class="card-body">
                    <h4 class="card-title mb-4">
                        <i class="bi bi-calculator me-2"></i>
                        Loan Calculator
                    </h4>
                    
                    <form id="loanComparisonForm" class="needs-validation" novalidate>
                        <div class="mb-3">
                            <label for="amount" class="form-label">Loan Amount</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="amount" name="amount" 
                                       min="1000" max="1000000" value="20000" required>
                                <select class="form-select" id="currency" name="currency" style="max-width: 100px;">
                                    <option value="AZN" selected>AZN</option>
                                    <option value="USD">USD</option>
                                    <option value="EUR">EUR</option>
                                </select>
                            </div>
                            <div class="invalid-feedback">
                                Please enter a valid loan amount between 1,000 and 1,000,000.
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="loan_type" class="form-label">Loan Type</label>
                            <select class="form-select" id="loan_type" name="loan_type" required>
                                <option value="personal" selected>Personal Loan</option>
                                <option value="mortgage">Mortgage</option>
                                <option value="auto">Auto Loan</option>
                            </select>
                            <div class="invalid-feedback">
                                Please select a loan type.
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="term_months" class="form-label">Loan Term</label>
                            <select class="form-select" id="term_months" name="term_months">
                                <option value="12">1 year (12 months)</option>
                                <option value="24">2 years (24 months)</option>
                                <option value="36">3 years (36 months)</option>
                                <option value="48">4 years (48 months)</option>
                                <option value="60" selected>5 years (60 months)</option>
                                <option value="72">6 years (72 months)</option>
                                <option value="84">7 years (84 months)</option>
                                <option value="120">10 years (120 months)</option>
                                <option value="180">15 years (180 months)</option>
                                <option value="240">20 years (240 months)</option>
                                <option value="300">25 years (300 months)</option>
                                <option value="360">30 years (360 months)</option>
                            </select>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-search me-2"></i>
                                Compare Rates
                            </button>
                        </div>
                    </form>

                    <!-- Loan Information -->
                    <div class="mt-4 pt-4 border-top">
                        <h6 class="text-muted mb-3">Loan Information</h6>
                        <ul class="list-unstyled small">
                            <li class="mb-2">
                                <i class="bi bi-info-circle me-2 text-info"></i>
                                Interest rates shown are indicative and may vary
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-shield-check me-2 text-success"></i>
                                All calculations include principal and interest
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-telephone me-2 text-primary"></i>
                                Contact banks directly for final approval
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Quick Tips -->
            <div class="feature-card mt-4">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="bi bi-lightbulb me-2"></i>
                        Loan Tips
                    </h5>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <strong>Compare APR:</strong> Look at the Annual Percentage Rate for true cost comparison
                        </li>
                        <li class="mb-2">
                            <strong>Check Requirements:</strong> Different banks have different eligibility criteria
                        </li>
                        <li class="mb-2">
                            <strong>Consider Total Cost:</strong> Lower monthly payments may mean higher total interest
                        </li>
                        <li class="mb-2">
                            <strong>Negotiate:</strong> Banks may offer better rates for good credit history
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="col-lg-8">
            <div id="loanResults">
                <!-- Default message -->
                <div class="text-center py-5">
                    <i class="bi bi-calculator display-1 text-muted mb-4"></i>
                    <h4 class="text-muted">Ready to Compare Loan Rates</h4>
                    <p class="text-muted">
                        Enter your loan details in the form on the left to see personalized rate comparisons 
                        from multiple Azerbaijan banks.
                    </p>
                    
                    <!-- Sample rates preview -->
                    <div class="row mt-5">
                        <div class="col-md-4 mb-3">
                            <div class="feature-card text-center">
                                <div class="card-body">
                                    <h5 class="text-success">Personal Loans</h5>
                                    <h3 class="text-primary">from 8.5%</h3>
                                    <p class="text-muted mb-0">Annual Interest Rate</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="feature-card text-center">
                                <div class="card-body">
                                    <h5 class="text-success">Mortgages</h5>
                                    <h3 class="text-primary">from 6.0%</h3>
                                    <p class="text-muted mb-0">Annual Interest Rate</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="feature-card text-center">
                                <div class="card-body">
                                    <h5 class="text-success">Auto Loans</h5>
                                    <h3 class="text-primary">from 7.5%</h3>
                                    <p class="text-muted mb-0">Annual Interest Rate</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Banks Information Section -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="text-center mb-4">
                <i class="bi bi-bank me-2"></i>
                Featured Banks
            </h3>
            
            <div class="row">
                <div class="col-lg-2 col-md-4 col-6 mb-3">
                    <div class="feature-card text-center h-100">
                        <div class="card-body">
                            <h6>PASHA Bank</h6>
                            <small class="text-muted">Full service banking</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-6 mb-3">
                    <div class="feature-card text-center h-100">
                        <div class="card-body">
                            <h6>Kapital Bank</h6>
                            <small class="text-muted">Digital banking leader</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-6 mb-3">
                    <div class="feature-card text-center h-100">
                        <div class="card-body">
                            <h6>International Bank</h6>
                            <small class="text-muted">Established 1992</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-6 mb-3">
                    <div class="feature-card text-center h-100">
                        <div class="card-body">
                            <h6>AccessBank</h6>
                            <small class="text-muted">Innovative solutions</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-6 mb-3">
                    <div class="feature-card text-center h-100">
                        <div class="card-body">
                            <h6>RabiteBank</h6>
                            <small class="text-muted">Customer focused</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-6 mb-3">
                    <div class="feature-card text-center h-100">
                        <div class="card-body">
                            <h6 class="text-success">+ More</h6>
                            <small class="text-muted">Additional banks</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FAQ Section -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="text-center mb-4">
                <i class="bi bi-question-circle me-2"></i>
                Frequently Asked Questions
            </h3>
            
            <div class="row">
                <div class="col-lg-6">
                    <div class="accordion" id="loanFAQ">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                    How accurate are the interest rates shown?
                                </button>
                            </h2>
                            <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#loanFAQ">
                                <div class="accordion-body">
                                    The rates shown are indicative based on current market data. Final rates may vary based on your credit score, income, and bank-specific criteria. Contact banks directly for personalized quotes.
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                    What documents do I need for a loan application?
                                </button>
                            </h2>
                            <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#loanFAQ">
                                <div class="accordion-body">
                                    Typically you'll need: Valid ID, proof of income (salary certificate), employment verification, bank statements, and collateral documents for secured loans. Requirements vary by bank and loan type.
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                    Can I apply for loans in foreign currency?
                                </button>
                            </h2>
                            <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#loanFAQ">
                                <div class="accordion-body">
                                    Yes, most Azerbaijan banks offer loans in USD and EUR in addition to AZN. Foreign currency loans may have different requirements and risk considerations due to exchange rate fluctuations.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <div class="feature-card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="bi bi-chat-dots me-2"></i>
                                Need Help?
                            </h5>
                            <p class="card-text">
                                Our AI assistant can help you understand loan options, compare rates, 
                                and answer questions about the application process.
                            </p>
                            <a href="/chat" class="btn btn-primary">
                                <i class="bi bi-chat-dots me-2"></i>
                                Chat with AI Assistant
                            </a>
                        </div>
                    </div>
                    
                    <div class="feature-card mt-3">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="bi bi-geo-alt me-2"></i>
                                Find Bank Branches
                            </h5>
                            <p class="card-text">
                                Locate the nearest bank branch to apply for your loan or get in-person assistance.
                            </p>
                            <a href="/branches" class="btn btn-success">
                                <i class="bi bi-geo-alt me-2"></i>
                                Find Branches
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Additional JavaScript specific to loan comparison page
    document.addEventListener('DOMContentLoaded', function() {
        // Auto-fill form based on URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('amount')) {
            document.getElementById('amount').value = urlParams.get('amount');
        }
        if (urlParams.get('type')) {
            document.getElementById('loan_type').value = urlParams.get('type');
        }
        
        // Update loan type descriptions
        document.getElementById('loan_type').addEventListener('change', function() {
            updateLoanTypeInfo(this.value);
        });
        
        // Real-time calculation preview
        ['amount', 'term_months'].forEach(field => {
            document.getElementById(field).addEventListener('input', debounce(updatePreview, 500));
        });
    });
    
    function updateLoanTypeInfo(loanType) {
        const infoTexts = {
            'personal': 'Personal loans are unsecured and can be used for any purpose. Typically have higher interest rates but faster approval.',
            'mortgage': 'Mortgages are secured by property with longer terms and lower rates. Used specifically for real estate purchases.',
            'auto': 'Auto loans are secured by the vehicle with competitive rates. Used specifically for car purchases.'
        };
        
        // You could add an info display element to show this
        console.log(infoTexts[loanType]);
    }
    
    function updatePreview() {
        const amount = parseFloat(document.getElementById('amount').value) || 0;
        const months = parseInt(document.getElementById('term_months').value) || 60;
        
        if (amount > 0) {
            // Simple calculation with estimated 10% rate for preview
            const monthlyRate = 0.10 / 12;
            const monthlyPayment = amount * (monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
            
            // You could show this preview somewhere in the UI
            console.log(`Estimated monthly payment: ${monthlyPayment.toFixed(2)} AZN`);
        }
    }
</script>
{% endblock %}